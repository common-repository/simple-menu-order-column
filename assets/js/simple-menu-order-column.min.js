/*!
 * Simple Menu Order Column
 *
 * https://github.com/ChillCode/simple-menu-order-column/
 *
 * Copyright (C) 2024 ChillCode
 *
 * @license Released under the General Public License v3.0 https://www.gnu.org/licenses/gpl-3.0.html
 */
!function(s){s.fn.smocDoReorder=function(e){const n=this;if(!n||s(e).prop("disabled"))return!1;function i(n,i,a){e.value=e.defaultValue,n&&n.css("display","inline-block"),s(e).prop("disabled",a).prop("title",i),window.console.warn("[Simple Order Menu Column] "+i)}let a=s(n).data("post-id");if(!a||isNaN(a))return i(null,"Invalid Post ID.",!0),!1;a=parseInt(a);const o="smoc-"+a.toString(),t=s(n).closest(".smoc-container");let l=s("#"+o+"-loader");l.length||(l=s("<span>").attr({id:o+"-loader",class:"smoc-loader dashicons dashicons-update",role:"img","aria-label":"Updating Menu Order"}).css({color:"#2ea2cc",animation:"iconrotation 2s infinite linear",display:"inline-block"}));let r=s("#"+o+"-loader-container");r.length?r.css({display:"none"}):(r=s("<div>").attr({id:o+"-loader-container"}).css({"padding-top":"5px",display:"none"}),r.append(l),t.append(r));let c=s("#"+o+"-success");c.length?c.css({display:"none"}):(c=s("<span>").attr({id:o+"-success",class:"smoc-success dashicons dashicons-yes-alt",role:"img","aria-label":"Success"}).css({"padding-top":"5px",color:"#7ad03a",display:"none"}),t.append(c));let d=s("#"+o+"-error");if(d.length?d.css({display:"none"}):(d=s("<span>").attr({id:o+"-error",class:"smoc-error dashicons dashicons-dismiss",role:"img","aria-label":"Error"}).css({"padding-top":"5px",color:"#a00",display:"none"}),t.append(d)),!typenow||!ajaxurl)return i(d,"Invalid WP installation, variables typenow or ajaxurl not initialized.",!0),!1;let p=s(n).val();if(p=s(n).val(),!p||isNaN(p))return i(d,"Invalid menu order value.",!1),!1;p=parseInt(p);let u=s(n).data("wpnonce");if(!u)return i(d,"Invalid field postNonce.",!0),!1;s(e).prop("disabled",!0),r.css({display:"inline-block"});const y=new URLSearchParams;y.set("action","smoc_reorder"),y.set("_wpnonce",u);const f=jQuery.ajax({url:ajaxurl+"?"+y,type:"POST",data:{post_type:typenow,post_id:a,post_menu_order:p}});f.done((function(n){if(n.success){c.css("display","inline-block"),s(e).prop("title",p),e.currentValue=p,e.defaultValue=p;const n=s(":input[id^=smoc]").index(e);s(":input[id^=smoc]").eq(n+1).trigger("select")}else e.value=e.defaultValue,d.css("display","inline-block")})),f.fail((function(){e.value=e.defaultValue,r.css("display","none"),c.css("display","none"),d.css("display","inline-block")})),f.always((function(){r.css({display:"none"}),s(e).prop("disabled",!1)}))},s("input[id^=smoc]").on("focus",(function(){this.currentValue=this.value,s(this).prop("title",parseInt(this.value));const e="smoc-"+s(this).data("post-id").toString();s("#"+e+"-loader-container").css({display:"none"}),s("#"+e+"-success").css({display:"none"}),s("#"+e+"-error").css({display:"none"})})),s("input[id^=smoc]").on("focusout",(function(e){if(s(this).prop("disabled"))return!1;this.currentValue!==this.value&&(window.confirm("Do you want to save the menu order?")?s(this).smocDoReorder(this):this.value=this.defaultValue)})),s("input[id^=smoc]").on("keypress",(function(e){"Enter"===e.key&&(e.preventDefault(),s(this).smocDoReorder(this))}))}(jQuery);